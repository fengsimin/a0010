<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\141\57\x66\x69\x6e\144\145\x72\x2f"; function __construct() { goto GRwuM; jscnC: kDof9: goto ZpEYf; GRwuM: if ($this->table) { goto kDof9; } goto CHHTy; CHHTy: $this->table = "\x66\x69\156\144\145\x72"; goto jscnC; ZpEYf: parent::__construct(); goto jMTC9; jMTC9: } protected function postAll($pid, $request_data) { goto xj8hf; ugPgo: return array("\146\x69\x6c\x65\163" => $files, "\160\141\x74\150\163" => $paths); goto uxxep; xj8hf: $files = $this->db->select($this->table)->where($request_data["\x77\x68\145\162\145"])->order($request_data["\157\162\x64\x65\162"])->all(); goto qkJv0; BNhyF: $level = $this->db->select($this->table, "\154\145\x76\x65\x6c")->where(array("\x69\144", "\75", $pid))->get(0); goto VjC_J; AxwK2: if (!$pid) { goto jVTF4; } goto BNhyF; dpOKm: $paths = $this->db->select($this->table, array("\151\x64", "\156\141\155\x65"))->where(array("\151\x64", "\111\116", $level), "\101\x4e\104", array("\x74\171\160\x65", "\x3d", "\x66\x6f\x6c\144\x65\162"))->all(); goto ame18; VjC_J: $level = array_filter(explode("\x2c", $level)); goto dpOKm; ame18: jVTF4: goto ugPgo; qkJv0: $paths = array(); goto AxwK2; uxxep: } protected function postAdd($request_data) { goto cD0Pm; qK_9B: $data["\156\x61\155\145"] = $name; goto sCScn; sCScn: $data["\164\x79\x70\x65"] = $type; goto VTv7G; fVk4u: $data["\x65\x78\164"] = end(explode("\56", $name)); goto x4S09; D0bXM: return $this->error("\344\270\x8a\344\274\xa0\346\x96\207\344\xbb\xb6\x20" . $name . "\40\xe5\244\261\350\xb4\245\xef\274\x81"); goto F9eKs; ZqLU8: $data["\x77\x69\144\x74\x68"] = $imagesize[0]; goto QDwgD; O3P32: O64YZ: goto oPaf_; EmQD2: DpUGD: goto wlUsj; DN5aG: if ($id = $this->db->insert($this->table, $data)->id()) { goto SNf5a; } goto vX5N3; TEDk8: return $this->error("\xe4\xb8\212\xe4\274\xa0\xe6\x96\207\xe4\273\266\x20" . $name . "\40\345\xa4\261\xe8\xb4\xa5\357\xbc\x81"); goto HTSpr; SWOM1: $level = $this->_getLevel($id); goto f7sB1; PBWR9: if (mkdir($this->_UTF82GBK("\x2e\x2e\x2f" . $path), 511, true)) { goto jRcJP; } goto C99Fl; vX5N3: unlink($filename); goto L8n3I; Dnlir: return $this->success(); goto O3P32; VTv7G: $data["\x70\x69\144"] = $foid ? $foid : 0; goto Yakrk; F9eKs: SNf5a: goto SWOM1; KP_nL: $type = mime_content_type("\x2e\56\x2f" . $path . $name); goto Ur30E; un19E: $filename = $this->_UTF82GBK("\x2e\56\x2f" . $path . $name); goto VdzSS; XdmVk: $data["\143\x74\151\x6d\145"] = time(); goto fVk4u; cD0Pm: $path = $request_data["\160\x61\164\150"]; goto vdGI2; C99Fl: return $this->error("\345\x88\233\xe5\xbb\xba\xe6\x96\x87\344\273\xb6\xe5\xa4\271\xe5\xa4\261\350\264\245\357\274\x81"); goto kItam; Yakrk: $data["\163\x69\172\145"] = $request_data["\x73\151\x7a\x65"]; goto XdmVk; s7593: $imagesize = getimagesize($filename); goto ZqLU8; pc2uv: cIC93: goto un19E; vdGI2: $name = $request_data["\x6e\141\x6d\145"]; goto KP_nL; n1QZR: $this->db->commit(); goto Dnlir; YemYX: if (is_dir($this->_UTF82GBK("\x2e\x2e\x2f" . $path))) { goto cIC93; } goto PBWR9; oPaf_: $this->db->rollBack(); goto TEDk8; x4S09: $this->db->beginTransaction(); goto DN5aG; VdzSS: if (!(stripos($type, "\151\155\x61\147\145") !== false && is_file($filename))) { goto DpUGD; } goto s7593; f7sB1: if (!$this->db->update($this->table, array("\x6c\x65\166\145\x6c" => $level), array("\x69\144", "\x3d", $id))->is()) { goto O64YZ; } goto n1QZR; Ur30E: $foid = $request_data["\146\157\x69\144"]; goto YemYX; L8n3I: $this->db->rollBack(); goto D0bXM; kItam: jRcJP: goto pc2uv; wlUsj: $data["\160\x61\164\150"] = $path; goto qK_9B; QDwgD: $data["\150\145\151\147\x68\x74"] = $imagesize[1]; goto EmQD2; HTSpr: } protected function postMkdir($request_data) { goto fSyu6; cQe7J: goto BT3YG; goto rz6Iw; BWfHg: ii0Zh: goto aHxBJ; VXG_f: $level = $this->_getLevel($id); goto A_bzb; d6jIr: BT3YG: goto JxGml; D5a2X: return $this->success(); goto d6jIr; b7GIT: return $this->error("\xe6\x97\240\346\x95\x88\xe7\232\204\xe5\x8f\202\346\225\xb0\xef\xbc\x81"); goto BWfHg; jL_YJ: $folder = $this->db->select($this->table, "\140\x6e\141\x6d\145\x60")->where(array("\151\x64", "\x49\x4e", $level), "\101\x4e\x44", array("\x74\171\x70\x65", "\x3d", "\x66\157\x6c\144\x65\162"))->all(); goto UIjZD; Fe1da: $this->db->beginTransaction(); goto Ri1Ee; evyP3: $data["\x73\x6f\162\164\x62\x79"] = 1; goto tlyay; UIjZD: foreach ($folder as $value) { $folder_path .= $value["\x6e\x61\155\145"] . "\57"; WJXWD: } goto o0nRk; eW4FB: $data["\160\x69\144"] = $pid; goto Dj8tw; qIxLa: return $this->error($name . "\40\346\226\x87\344\273\xb6\345\244\xb9\xe5\267\xb2\345\xad\230\345\234\xa8\xef\274\x81"); goto mRhRu; Ssw76: PtBdI: goto Z32NK; A_bzb: if ($this->db->update($this->table, array("\154\x65\x76\145\154" => $level), array("\151\144", "\x3d", $id))->is()) { goto LuiM9; } goto RRid8; aHxBJ: $data = array(); goto yeUgK; RRid8: rmdir($dirname); goto FlT6T; Ri1Ee: $data["\160\x61\x74\x68"] = $this->root . $folder_path; goto evyP3; rKUyn: if ($id = $this->db->insert($this->table, $data)->id()) { goto qHOvs; } goto mxLe_; lWSmT: return $this->error("\345\210\x9b\345\xbb\272\xe6\226\207\xe4\273\266\xe5\xa4\271\345\xa4\261\xe8\xb4\xa5\357\xbc\201"); goto xrzuw; FlT6T: $this->db->rollBack(); goto SFPOJ; mRhRu: J71ca: goto okhcV; Z32NK: $dirname = $this->_UTF82GBK("\x2e\56\x2f" . $this->root . $folder_path . $name); goto EGvlE; fSyu6: $pid = $request_data["\x70\151\x64"]; goto T8rhl; by7B1: if (!($name === null || $name === '')) { goto ii0Zh; } goto b7GIT; mxLe_: rmdir($dirname); goto fvghx; l6Pxf: return $this->error("\345\210\x9b\345\273\272\xe6\226\x87\xe4\273\xb6\xe5\244\xb9\345\xa4\xb1\350\xb4\245\357\274\x81"); goto tBUtw; fvghx: $this->db->rollBack(); goto lWSmT; okhcV: if (mkdir($dirname, 493, true)) { goto esKkt; } goto l6Pxf; Dj8tw: $folder_path = ''; goto RassK; EGvlE: if (!is_dir($dirname)) { goto J71ca; } goto qIxLa; yeUgK: $data["\x6e\x61\x6d\145"] = $name; goto eW4FB; jpznj: $this->db->commit(); goto D5a2X; o0nRk: tEMWx: goto Ssw76; RassK: $level = $this->db->select($this->table, "\x60\x6c\x65\x76\x65\x6c\140")->where(array("\x69\144", "\x3d", $pid))->get(0); goto PN719; PN719: if (!$level) { goto PtBdI; } goto qqbdx; xrzuw: qHOvs: goto VXG_f; tBUtw: esKkt: goto Fe1da; T8rhl: $name = $request_data["\x6e\141\x6d\145"]; goto by7B1; tlyay: $data["\x74\x79\160\145"] = "\x66\x6f\x6c\x64\145\162"; goto S8rP3; SFPOJ: return $this->error("\345\210\233\345\273\272\346\x96\207\xe4\xbb\266\xe5\244\271\xe5\xa4\261\xe8\xb4\xa5\xef\xbc\201"); goto cQe7J; qqbdx: $level = array_filter(explode("\54", $level)); goto jL_YJ; rz6Iw: LuiM9: goto jpznj; S8rP3: $data["\143\x74\x69\155\145"] = time(); goto rKUyn; JxGml: } protected function postRename($request_data) { goto XRW3w; Z8ErA: if (rename($oldname, $newname)) { goto lWwiy; } goto J3CE5; apaDA: goto goHNU; goto AeMr3; XPFMT: $this->db->rollBack(); goto C_B8v; KZLVz: SmFU4: goto Os25N; lhWqt: $path = $finder["\160\x61\x74\x68"]; goto gJOi5; m1QHu: $name = $request_data["\x6e\x61\x6d\145"]; goto mvjDE; N3Hhq: if ($this->db->update($this->table, array("\156\x61\x6d\145" => $name), array("\151\x64", "\x3d", $id))->is()) { goto a39j8; } goto tEOdo; Y5Tbi: KXjxv: goto HyjE1; T3Xni: return $this->error("\346\227\240\xe6\225\x88\xe7\232\204\345\x8f\x82\xe6\x95\xb0\357\274\201"); goto KZLVz; yEBVp: goHNU: goto HS0v0; X9iCm: return $this->error("\346\x96\207\344\xbb\xb6\345\xa4\271\xe9\x87\x8d\xe5\x91\275\345\x90\215\345\xa4\261\xe8\xb4\245\357\xbc\x81"); goto nTmql; YMUvc: if ($this->db->update($this->table, array("\156\x61\x6d\145" => $name), array("\151\144", "\x3d", $id))->is()) { goto AnULZ; } goto XPFMT; J3CE5: $this->db->rollBack(); goto RvQgC; QarWB: $this->db->rollBack(); goto X9iCm; ToZ4G: if ($is_path_update !== false) { goto R_TKe; } goto dIH8g; hKzvG: return $this->error("\xe6\x96\207\344\xbb\xb6\351\x87\215\345\221\xbd\345\220\x8d\xe5\xa4\261\350\264\xa5\357\xbc\x81"); goto q7Gl1; RvQgC: return $this->error("\346\226\x87\xe4\xbb\xb6\xe9\207\x8d\345\221\xbd\345\220\215\xe5\244\261\350\xb4\245\xef\274\x81"); goto xxsd7; iPi4V: R_TKe: goto r7y0e; kFtt9: Mr_u7: goto YMUvc; xxsd7: goto oKEnF; goto AcHcX; tEOdo: $this->db->rollBack(); goto hKzvG; kBmMK: $sublist = $this->db->select($this->table, array("\x69\144", "\154\145\x76\x65\154", "\x74\171\x70\145"))->where(array("\154\145\x76\x65\x6c", "\114\111\113\105", "\x25\54{$id}\x2c\x25"))->all(); goto wAriT; gJOi5: if (!(!$path || stripos($path, $this->root) === false)) { goto FFhPB; } goto NRsF7; Os25N: $finder = $this->db->select($this->table, array("\160\141\164\x68", "\156\x61\x6d\145", "\154\x65\x76\x65\154"))->where(array("\x69\144", "\75", $id))->get(); goto lhWqt; LeERD: $this->db->beginTransaction(); goto bGPsd; yPqVP: $newname = $this->_UTF82GBK("\56\x2e\x2f" . $path . $name); goto LeERD; Z45yz: if (rename($oldname, $newname)) { goto JyMR0; } goto Vw7C1; Q7RA5: pDLco: goto N3Hhq; bPbRA: return $this->success(); goto xItra; M5Cgo: goto VhNLf; goto HFs2O; EdpTv: $oldname = $this->_UTF82GBK("\56\x2e\x2f" . $path . $finder["\x6e\x61\155\x65"]); goto yPqVP; bGPsd: if (is_file($oldname)) { goto pDLco; } goto wQ4Ap; hbQAq: return $this->success(); goto x2Ra4; HyjE1: goto QakqQ; goto kFtt9; BWSJc: FFhPB: goto EdpTv; wAriT: foreach ($sublist as $sub) { goto w1bZO; IE63b: mBHZf: goto KkfnZ; awULF: goto et1h0; goto IE63b; KkfnZ: mgu_F: goto ZRTa9; DcY1Y: $level = array_filter(explode("\54", $sub["\154\x65\x76\145\x6c"])); goto pTCid; srUa_: $is_path_update = $this->db->update($this->table, array("\160\x61\164\x68" => $this->root . $newpath), array("\151\x64", "\75", $sub["\151\x64"]))->is(); goto ohPiX; tyOr2: $newpath = ''; goto DcY1Y; w1bZO: if (!($sub["\x6c\x65\x76\145\x6c"] == $finder["\154\x65\x76\145\x6c"])) { goto gZLVb; } goto M3Hlh; MhTBF: gZLVb: goto tyOr2; BftZK: HdMKl: goto srUa_; M3Hlh: goto mgu_F; goto MhTBF; ohPiX: if (!($is_path_update === false)) { goto mBHZf; } goto awULF; pTCid: foreach ($level as $lid) { goto s0tDV; IKSUJ: $newpath .= $level_name != '' ? $level_name . "\x2f" : ''; goto BfROL; DgrhI: wo6LL: goto W1vT9; BfROL: nKz_N: goto XLp_B; W1vT9: $level_name = $levelobj["\156\x61\155\145"]; goto IKSUJ; I0K4N: if (!($sub["\x74\x79\x70\x65"] == "\x66\x6f\154\144\145\162" && $sub["\x6c\145\x76\145\x6c"] == $levelobj["\154\x65\x76\145\x6c"])) { goto wo6LL; } goto bJeVX; s0tDV: $levelobj = $this->db->select($this->table, array("\156\141\x6d\145", "\x6c\x65\x76\145\x6c"))->where("\x69\x64\40\75\40{$lid}\x20\x41\116\x44\x20\x74\x79\x70\x65\40\75\40\47\146\157\x6c\x64\145\x72\47")->get(); goto I0K4N; bJeVX: goto nKz_N; goto DgrhI; XLp_B: } goto BftZK; ZRTa9: } goto T1iKa; x2Ra4: oKEnF: goto Y5Tbi; HS0v0: QakqQ: goto bHOFO; NRsF7: return $this->error("\xe6\227\240\346\225\210\xe7\232\x84\xe8\xb7\257\345\276\204\357\xbc\201"); goto BWSJc; HFs2O: JyMR0: goto kBmMK; Vw7C1: $this->db->rollBack(); goto MX8t4; AcHcX: lWwiy: goto bgp85; nTmql: goto TlFwj; goto iPi4V; LJvNJ: a39j8: goto Z8ErA; r7y0e: $this->db->commit(); goto bPbRA; xItra: TlFwj: goto Bgpe6; Bgpe6: VhNLf: goto yEBVp; wQ4Ap: if (is_dir($oldname)) { goto Mr_u7; } goto wol7g; XRW3w: $id = $request_data["\x69\x64"]; goto m1QHu; AeMr3: AnULZ: goto Z45yz; mvjDE: if (!(!$id || $name === null || $name === '')) { goto SmFU4; } goto T3Xni; C_B8v: return $this->error("\xe6\x96\207\344\273\266\xe5\xa4\xb9\xe9\x87\215\xe5\x91\xbd\345\220\x8d\345\244\xb1\xe8\264\xa5\xef\xbc\x81"); goto apaDA; png51: goto QakqQ; goto Q7RA5; T1iKa: et1h0: goto ToZ4G; q7Gl1: goto KXjxv; goto LJvNJ; dIH8g: rename($newname, $oldname); goto QarWB; MX8t4: return $this->error($name . "\x20\xe6\226\207\xe4\273\266\xe5\xa4\271\xe5\xb7\xb2\345\xad\230\xe5\234\xa8\xef\274\201"); goto M5Cgo; bgp85: $this->db->commit(); goto hbQAq; wol7g: return $this->error("\346\211\276\344\xb8\215\xe5\x88\xb0\xe9\207\x8d\345\x91\275\xe5\x90\x8d\xe7\x9a\x84\xe6\226\207\344\xbb\266\57\xe6\x96\x87\xe4\273\xb6\xe5\244\xb9\xef\xbc\201"); goto png51; bHOFO: } protected function postIsFile($request_data) { goto tII6m; YvEC1: lptOk: goto gveMA; Gx8Yy: return $this->error($name . "\40\346\x96\207\xe4\273\266\xe4\270\215\xe5\255\230\345\234\250\xef\xbc\201"); goto bXpOX; tII6m: $path = $request_data["\x70\141\x74\150"]; goto iG93k; efRt9: if (file_exists($this->_UTF82GBK("\56\56\57" . $path . $name))) { goto T2b0o; } goto Gx8Yy; y0pb8: T2b0o: goto f8xeC; bXpOX: goto lptOk; goto y0pb8; f8xeC: return $this->success($name . "\x20\xe6\226\x87\xe4\273\xb6\345\xb7\xb2\345\255\230\xe5\234\xa8\357\274\x81"); goto YvEC1; iG93k: $name = $request_data["\156\x61\155\145"]; goto efRt9; gveMA: } protected function postDelete($request_data) { goto sGu8V; sGu8V: $ids = $request_data["\x69\x64"]; goto VnOog; fNnct: return $this->success(); goto penRl; r6Zpl: q4UmP: goto fNnct; VnOog: foreach ($ids as $id) { goto tBh4X; hNht0: rSF_h: goto zYqYd; lmizv: if (is_file($filename)) { goto X7cf0; } goto IW9Ar; v4KlY: $this->db->delete($this->table, array("\x6c\x65\166\145\154", "\114\111\113\105", "\45\x2c{$id}\x2c\x25")); goto r_pgq; qOmmj: $filename = $this->_UTF82GBK("\56\x2e\57" . $path . $name); goto lmizv; zYqYd: FN7Fy: goto y6VaM; UNkiu: if (!(!$path || stripos($path, "\144\141\x74\x61\x2f\146\151\x6e\x64\x65\x72\57") === false || $name == null || $name == '')) { goto IYynP; } goto OLSEF; Mm14L: S2oHM: goto lR_xF; dfdO0: $this->_rmdir($filename); goto eThC0; IdOSW: if (!$this->db->delete($this->table, array("\x69\144", "\x3d", $id))->is()) { goto S2oHM; } goto u_s17; wwlOB: $path = $file["\160\141\164\150"]; goto jeAmU; eThC0: vzaaH: goto hNht0; A4hy7: X7cf0: goto IdOSW; u_s17: @unlink($filename); goto Mm14L; OLSEF: $this->db->delete($this->table, array("\151\x64", "\75", $id))->is(); goto hszvd; cyvhg: IYynP: goto qOmmj; Du_Cq: eZPbx: goto wwlOB; tBh4X: $file = $this->db->select($this->table, array("\x70\x61\164\150", "\156\x61\155\145"))->where(array("\x69\x64", "\x3d", $id))->get(); goto uh7vX; r_pgq: goto rSF_h; goto A4hy7; BXjbB: goto FN7Fy; goto Du_Cq; IW9Ar: if (is_dir($filename)) { goto C3uiP; } goto v4KlY; RYVhr: C3uiP: goto N1PKL; N1PKL: if (!$this->db->delete($this->table, array("\154\145\x76\145\x6c", "\x4c\111\113\105", "\45\x2c{$id}\54\x25"))->is()) { goto vzaaH; } goto dfdO0; jeAmU: $name = $file["\x6e\141\155\145"]; goto UNkiu; lR_xF: goto rSF_h; goto RYVhr; uh7vX: if ($file) { goto eZPbx; } goto BXjbB; hszvd: goto FN7Fy; goto cyvhg; y6VaM: } goto r6Zpl; penRl: } protected function getCurPath($foid) { goto o93Oo; VmspP: $level = array_filter(explode("\x2c", $level)); goto vyvJ4; vyvJ4: $data = $this->db->select($this->table, array("\151\144", "\156\141\155\x65"))->where(array(array("\x69\x64", "\x49\x4e", $level), "\x41\x4e\104", array("\x74\x79\x70\x65", "\75", "\146\x6f\x6c\144\145\x72")))->all(); goto gOJEu; gOJEu: return $this->success('', $data); goto IyVZU; o93Oo: $level = $this->db->select($this->table, "\154\145\166\145\154")->where(array("\151\144", "\75", $foid))->get(0); goto VmspP; IyVZU: } }
