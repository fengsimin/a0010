<?php
//Copyright (c) 2016 iFeiwu.com
 class Uploader extends Ifeiwu { function __construct() { } protected function postImage($request_data) { goto mYiJJ; dAeB4: if ($handle->processed) { goto cC_sa; } goto BTNdG; wCetl: zgtMk: goto MD3xN; q6bPP: $file_overwrite = $_POST["\146\x69\x6c\145\x5f\x6f\166\145\x72\x77\162\151\x74\145"]; goto tE721; urpV4: $_FILES["\146\x69\x6c\145"]["\145\162\x72\x6f\162"] = $_POST["\x66\x69\x6c\x65\x5f\145\162\x72\x6f\x72"]; goto hfnet; QzBY1: $handle->file_overwrite = $file_overwrite ? true : false; goto rFLbr; sJVX4: AQGJM: goto dtoTF; P6rBv: $upload_root = "\56\56\x2f"; goto Hfv4F; amL0U: dWLJ5: goto zIdL1; yi1pd: $handle->image_convert = $image_convert; goto QPBeO; zBl2t: $image_x = explode("\x2c", $_POST["\x69\155\x61\147\145\137\x78"]); goto JArMU; MD3xN: $file_name_body_pre = explode("\54", $_POST["\x66\x69\154\x65\137\x6e\141\x6d\145\137\142\x6f\x64\x79\x5f\160\162\x65"]); goto zBl2t; QPBeO: VG1gd: goto JWOqH; Hfv4F: $file_new_name_body = $_POST["\146\x69\x6c\x65\x5f\x6e\x65\x77\x5f\x6e\x61\x6d\x65\x5f\142\x6f\144\x79"]; goto q6bPP; uacZD: czWq4: goto QuMTZ; zIdL1: return $this->success('', array("\160\x61\164\150" => $file_save_path, "\x69\155\x61\147\x65" => $handle->file_dst_name, "\163\x69\172\x65" => $handle->file_src_size, "\x77\x69\x64\164\x68" => $handle->image_src_x, "\x68\145\x69\x67\150\x74" => $handle->image_src_y, "\164\x79\160\x65" => $handle->image_dst_type, "\145\170\164" => $handle->file_dst_name_ext)); goto sJVX4; QuMTZ: ifeiwu\Loader::import("\x65\x78\x74\x65\x6e\x64\57\125\160\154\x6f\x61\x64"); goto lZ5h_; Yf_7M: goto AQGJM; goto yPQ8x; LFZ82: goto DVSBm; goto wCetl; Z3MxP: $_FILES["\146\151\154\145"]["\163\151\x7a\x65"] = $_POST["\146\151\x6c\145\x5f\x73\x69\172\145"]; goto urpV4; tLBmE: goto nKW1i; goto uacZD; bZEXL: ZGcom: goto dAeB4; Ckq3N: return $this->error("\346\227\240\xe6\x95\210\xe7\x9a\x84\346\x96\207\344\273\266\344\xbf\xa1\346\x81\257\357\274\201"); goto tLBmE; O2fZ1: if (!$image_convert) { goto VG1gd; } goto yi1pd; BTNdG: return $this->error($handle->log); goto Yf_7M; yPQ8x: cC_sa: goto ZDSrn; tE721: $image_resize = $_POST["\151\155\x61\x67\145\137\x72\x65\163\151\172\x65"]; goto Tr2Dm; ZSwcg: foreach ($file_name_body_pre as $key => $prefix) { goto sxNC7; vOKBF: if (!$prefix) { goto o2QDq; } goto AoJqp; i6bYg: $height = $image_y[$key]; goto wRosn; dGomL: $handle->image_x = $handle->image_src_x; goto gw91b; EfGC2: nQdsK: goto ra5Ka; mdDM0: $handle->jpeg_quality = $quality; goto K_pX7; vg6CJ: k2XH8: goto SzIDR; sTUPH: $handle->image_y = $height; goto vg6CJ; BJgiS: $handle->Process($upload_root . "\57" . $file_save_path); goto KBhfH; fL43b: if ($height && $handle->image_src_y > $height) { goto xxsGO; } goto CpRO5; AoJqp: $handle->image_resize = $image_resize ? true : false; goto TaQVh; FxStG: YfFTp: goto fL43b; wP1kD: if (!$quality) { goto ivD6U; } goto mdDM0; PTIr_: if ($width && $handle->image_src_x > $width) { goto WMpws; } goto dGomL; sxNC7: $width = $image_x[$key]; goto i6bYg; YJdro: o2QDq: goto wP1kD; SzIDR: if (!$file_new_name_body) { goto nQdsK; } goto DczKZ; KBhfH: B0mel: goto o1UY9; gw91b: goto YfFTp; goto E5yJd; ra5Ka: $handle->file_overwrite = $file_overwrite ? true : false; goto BJgiS; K_pX7: ivD6U: goto iFKM6; iFKM6: if (!$image_convert) { goto gpCmR; } goto EDU9U; gbZOE: goto k2XH8; goto tpIFH; TaQVh: $handle->file_name_body_pre = $prefix; goto YJdro; DczKZ: $handle->file_new_name_body = $file_new_name_body; goto EfGC2; rG8U7: gpCmR: goto PTIr_; CpRO5: $handle->image_ratio_y = true; goto gbZOE; EDU9U: $handle->image_convert = $image_convert; goto rG8U7; VM5Re: $handle->image_x = $width; goto FxStG; wRosn: $quality = $jpeg_quality[$key]; goto vOKBF; E5yJd: WMpws: goto VM5Re; tpIFH: xxsGO: goto sTUPH; o1UY9: } goto WKJn9; WKFI6: $handle->jpeg_quality = $quality; goto tt7PL; LW0ue: if (!$handle->uploaded) { goto ZGcom; } goto P6rBv; pxstI: $handle->file_new_name_body = $file_new_name_body; goto Wk1Ah; rFLbr: $handle->Process($upload_root . "\x2f" . $file_save_path); goto LFZ82; WKJn9: Uoe8k: goto XGvvh; dtoTF: nKW1i: goto a97BO; GRF0s: $image_convert = $_POST["\151\x6d\141\x67\x65\137\x63\157\x6e\166\x65\162\164"]; goto litJI; XGvvh: DVSBm: goto bZEXL; qYSYl: $_FILES["\x66\151\x6c\145"]["\164\x79\x70\x65"] = $_POST["\x66\151\x6c\x65\137\x74\x79\x70\145"]; goto Z3MxP; lZ5h_: $handle = new Upload($_FILES["\146\151\154\x65"]); goto LW0ue; JWOqH: if (!$file_new_name_body) { goto iBOhd; } goto pxstI; g_Kit: if (!$quality) { goto ODMGd; } goto WKFI6; hfnet: if (!empty($_FILES["\146\151\x6c\x65"])) { goto czWq4; } goto Ckq3N; ZDSrn: if (!($file_save_path == "\57")) { goto dWLJ5; } goto UIZWh; VrPxf: $quality = end($jpeg_quality); goto g_Kit; mYiJJ: $_FILES["\x66\x69\154\x65"]["\x6e\141\x6d\145"] = $_POST["\146\151\x6c\145\137\156\141\155\145"]; goto qYSYl; QLAHn: if ($image_resize == 1) { goto zgtMk; } goto VrPxf; tt7PL: ODMGd: goto O2fZ1; Wk1Ah: iBOhd: goto QzBY1; litJI: $jpeg_quality = explode("\54", $_POST["\152\x70\x65\x67\x5f\x71\165\141\x6c\151\x74\x79"]); goto QLAHn; JArMU: $image_y = explode("\x2c", $_POST["\151\155\x61\x67\145\x5f\x79"]); goto ZSwcg; Tr2Dm: $file_save_path = $_POST["\146\x69\154\x65\137\163\x61\x76\145\137\160\141\164\x68"]; goto GRF0s; UIZWh: $file_save_path = ''; goto amL0U; a97BO: } protected function postFile($request_data) { goto N7r2A; N7r2A: $save_path = "\x2e\56\57" . $this->_UTF82GBK($_POST["\163\141\166\145\137\x70\141\164\150"]); goto d2b0Q; JOlwZ: $file = $_FILES["\146\151\154\x65"]; goto mqdV6; Sqsx1: hUQ2d: goto rVrDi; Sgrtu: $this->_createFileFromChunks($save_path, $temp_dir, $resumableFilename, $_POST["\x72\145\163\165\x6d\x61\x62\x6c\145\x43\x68\x75\x6e\153\123\151\172\x65"], $_POST["\162\145\163\x75\x6d\x61\142\x6c\145\124\157\164\x61\154\x53\151\x7a\x65"]); goto oNoMF; rVrDi: if (!move_uploaded_file($file["\164\x6d\x70\137\x6e\x61\155\x65"], $dest_file)) { goto tpyTH; } goto Sgrtu; d2b0Q: $resumableFilename = $this->_UTF82GBK($_POST["\x72\145\163\165\x6d\141\x62\x6c\145\x46\x69\154\145\156\x61\x6d\x65"]); goto kAuIB; J9z_s: $this->_debug("\x65\x72\162\x6f\x72\x20" . $file["\145\x72\x72\157\x72"] . "\40\x69\x6e\x20\x66\151\154\x65\40" . $resumableFilename); goto qOt57; J3CQL: tpyTH: goto c76j2; vKvsX: $dest_file = $temp_dir . "\57" . $resumableFilename . "\x2e\x70\141\162\164" . $resumableChunkNumber; goto K4Krl; z1_3J: $resumableIdentifier = $_POST["\162\x65\163\165\155\x61\142\154\x65\x49\x64\x65\156\x74\x69\x66\151\145\162"]; goto cgHVV; SsxB1: $_FILES["\x66\x69\x6c\x65"]["\163\151\172\145"] = $_POST["\146\151\154\145\137\x73\x69\172\145"]; goto ZvTdi; PQSIo: XL0bR: goto YwNEo; K4Krl: if (is_dir($temp_dir)) { goto hUQ2d; } goto AWyNU; oNoMF: goto XL0bR; goto J3CQL; mqdV6: if (!($file["\x65\x72\x72\157\x72"] != 0)) { goto x0HGX; } goto J9z_s; IOwt1: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto vKvsX; cgHVV: $_FILES["\x66\x69\154\x65"]["\156\x61\155\x65"] = $_POST["\146\151\154\145\137\x6e\x61\x6d\x65"]; goto HJvLE; AWyNU: mkdir($temp_dir, 511, true); goto Sqsx1; ZvTdi: $_FILES["\146\x69\154\145"]["\145\162\x72\157\x72"] = $_POST["\x66\x69\154\x65\x5f\145\162\162\x6f\x72"]; goto JOlwZ; qOt57: x0HGX: goto IOwt1; HJvLE: $_FILES["\146\151\x6c\x65"]["\164\x79\160\145"] = $_POST["\x66\151\x6c\x65\x5f\x74\171\x70\145"]; goto SsxB1; kAuIB: $resumableChunkNumber = $_POST["\x72\x65\x73\165\x6d\141\142\154\x65\x43\x68\x75\x6e\x6b\116\x75\155\142\145\x72"]; goto z1_3J; c76j2: $this->_debug("\x45\x72\162\x6f\x72\40\x73\141\x76\151\x6e\147\40\x28\155\157\166\145\x5f\165\160\154\x6f\x61\144\x65\144\x5f\146\151\x6c\x65\x29\40\143\150\x75\x6e\153\40" . $resumableChunkNumber . "\x20\x66\x6f\x72\x20\146\151\x6c\x65\40" . $resumableFilename); goto PQSIo; YwNEo: } protected function getFile() { goto gd0G1; vwtfT: return 202; goto TFqUy; Spv4A: $resumableFilename = $this->_UTF82GBK($_GET["\x72\145\x73\165\x6d\141\x62\x6c\145\106\x69\154\145\x6e\x61\x6d\145"]); goto tY6Ur; tkOwu: return 404; goto v9Wxf; L7Vmw: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto pogif; v9Wxf: goto TT27A; goto Hsi7l; Hsi7l: WxzdQ: goto vwtfT; Mgg6A: if (file_exists($chunk_file)) { goto WxzdQ; } goto tkOwu; pogif: $chunk_file = $temp_dir . "\x2f" . $resumableFilename . "\x2e\160\x61\x72\164" . $resumableChunkNumber; goto Mgg6A; TFqUy: TT27A: goto jY17v; gd0G1: $save_path = "\x2e\56\x2f" . $this->_UTF82GBK($_GET["\163\x61\x76\145\137\160\x61\x74\150"]); goto Spv4A; oieFe: $resumableIdentifier = $_GET["\x72\145\163\165\x6d\x61\142\x6c\x65\x49\144\x65\156\x74\x69\146\x69\145\x72"]; goto L7Vmw; tY6Ur: $resumableChunkNumber = $_GET["\x72\x65\163\x75\155\141\142\154\145\x43\x68\x75\156\153\116\165\155\x62\145\x72"]; goto oieFe; jY17v: } private function _createFileFromChunks($save_path, $temp_dir, $fileName, $chunkSize, $totalSize) { goto l9nwa; aWvR5: if (!($total_files * $chunkSize >= $totalSize - $chunkSize + 1)) { goto Kq7oH; } goto etzid; iUsIM: goto Yiba7; goto DeDY_; vY_Gh: ybUrM: goto DCUY1; etzid: if (($fp = fopen($save_path . "\x2f" . $fileName, "\x77")) !== false) { goto ybUrM; } goto hRs0D; YLzRp: return false; goto JYp96; q5ACz: mSGwa: goto FDKdg; YnTmQ: $this->_rrmdir($temp_dir); goto zNgxW; l9nwa: $total_files = 0; goto J71R6; YYV1j: aMCdE: goto d_nwI; qE24q: fwrite($fp, file_get_contents($temp_dir . "\x2f" . $fileName . "\x2e\160\x61\162\x74" . $i)); goto YYV1j; zNgxW: goto bt161; goto q5ACz; JYp96: goto pmmDq; goto vY_Gh; maFjG: Kq7oH: goto yXdS3; DeDY_: PQwQL: goto fEyA5; adXcX: if (!($i <= $total_files)) { goto PQwQL; } goto qE24q; fEyA5: fclose($fp); goto yLSfF; WmMsK: HpKiE: goto aWvR5; DCUY1: $i = 1; goto QjLAf; XhZsc: if (rename($temp_dir, $temp_dir . "\137\125\116\125\x53\105\104")) { goto mSGwa; } goto YnTmQ; d_nwI: $i++; goto iUsIM; FDKdg: $this->_rrmdir($temp_dir . "\137\x55\116\125\123\105\x44"); goto OTrW7; hRs0D: $this->_debug("\x63\x61\156\156\157\x74\40\143\162\x65\x61\164\145\40\x74\150\x65\40\144\x65\163\164\x69\156\x61\164\151\157\156\x20\146\x69\x6c\x65"); goto YLzRp; J71R6: foreach (scandir($temp_dir) as $file) { goto ZDwqQ; ZDwqQ: if (!(stripos($file, $fileName) !== false)) { goto MTPoB; } goto PRUGt; PRUGt: $total_files++; goto Z5hSg; JI0b8: RV_KH: goto znSRb; Z5hSg: MTPoB: goto JI0b8; znSRb: } goto WmMsK; OTrW7: bt161: goto maFjG; QjLAf: Yiba7: goto adXcX; yLSfF: pmmDq: goto XhZsc; yXdS3: } private function _rrmdir($dir) { goto p6kjD; nhyVW: S2BeK: goto Z1bLh; sHsXT: $objects = scandir($dir); goto AdtGK; AdtGK: foreach ($objects as $object) { goto zFiUO; ndU2o: $this->_rrmdir($dir . "\x2f" . $object); goto wqEuc; GNoF7: s0CAG: goto ndU2o; DkpIQ: GciaC: goto DwJ1e; DwJ1e: M3DQu: goto zkOVg; n0Jp6: if (filetype($dir . "\57" . $object) == "\144\151\x72") { goto s0CAG; } goto YRNFP; zFiUO: if (!($object != "\x2e" && $object != "\x2e\x2e")) { goto GciaC; } goto n0Jp6; YRNFP: unlink($dir . "\57" . $object); goto etzsu; wqEuc: Z0BgK: goto DkpIQ; etzsu: goto Z0BgK; goto GNoF7; zkOVg: } goto jharB; p6kjD: if (!is_dir($dir)) { goto S2BeK; } goto sHsXT; qYSyS: reset($objects); goto pilfy; pilfy: rmdir($dir); goto nhyVW; jharB: r2aFD: goto qYSyS; Z1bLh: } }
